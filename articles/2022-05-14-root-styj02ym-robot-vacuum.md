---
layout: post
title: Root доступ на пилосос Xiaomi STYJ02YM (Viomi V7) Vacuum Robot
permalink: /blog/root-styj02ym-robot-vacuum.html
---
Сучасний робот пилосос оснащено камерою, радаром і бог зна ще чим. При цьому усьому він завжди має доступ до інтернет і, теоретично, може надсилати розмови, фото, адреси та карти ваших помешкання якомусь абстрактному Лі Хуан Чжану. А беручи до уваги те, що скоріш за все, у вашому будинку (*та й на вас самих і на усіх членах вашої родини*) окрім робота пилососа ще купа різної іншої "розумної" техніки, то й же Лі Хуан Чжан, якщо того захоче, може знати про вас стільки всього, що ви й самі про себе не здогадуєтесь. Серцевий ритм, кількість кисню у крові, температуру повітря і підлоги у ваших кімнатах, історії перегляду відео, яскравість освітлення... Ще трохи і вони будуть знати ваш гормональний фон. Страшне.

Отже, отака от параноя заставила мене замислитись над можливістю відвʼязати робота пилососа від китайських "хмар" і використовувати його якось локально. Знайшов штуку під назвою [Valetudo](https://valetudo.cloud/), але для встановлення потрібний root доступ до операційної системи робота. Власне про це і пишу. Насправді в інтернетах вже достатноь матеріалів на цю тему. Тут я спробував скомпілювати усе до купи, послідовно і українською мовою.

<!-- more -->

Потрібно замінити оригінальний файл оцим:

```sh
#!/bin/sh
export ENV='/etc/adb_profile'
exec /bin/sh "$@"
```

```sh
touch adb_shell
chmod 755 adb_shell
```

Для того щоб не "тиркати" команду `adb push -a adb_shell /bin/adb_shell` щосекундно вручну, чекаючи на той самий момент коли з ним таки можна взаємодіяти, пишемо в консолі отаке:

```sh
while true; do adb push -a adb_shell /bin/adb_shell | grep -v "no devices"; done
```

і чекаємо допоки не побачимо наступне

```text
adb_shell: 1 file pushed, 0 skipped. 0.0 MB/s (100 bytes in 0.033s)
```

Після цього висмикуємо із робота дріт.

Запускаємо щоб вимкнути автозапуск основного процессу, який не дає нормально працювати через `adb`.
Спокійно, це безпечно тому, що тут ми видаляємо сімлінк на файл а не сам файл. Потім все відновимо.

```sh
while true; do (adb shell rm /etc/rc.d/S90robotManager && echo "Done") 2>&1 | grep -v "no devices"; done
```

Вставляємо USB назад і чекаємо

_Джерела:_

- https://itooktheredpill.irgendwo.org/2020/rooting-xiaomi-vacuum-robot/
- https://blog.lupin.rocks/fixing-xiaomi-styj02ym-update-stuck-on-80/
- https://github.com/rumpeltux/viomi-rooting
- https://github.com/rumpeltux/viomi-rooting/blob/master/viomi-root.sh#L208
