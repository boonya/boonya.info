---
layout: post
title: Как загрузиться с USB HDD в VirtualBox.
permalink: /blog/virtualbox-boot-from-usb-hdd.html
redirect_from: /my-blog/virtualbox-boot-from-usb-hdd.html
---
Есть у меня компьютер с которым я постоянно работаю и развлекаюсь, в качестве операционной системы на нем крутится Windows 7. Так же у меня имеется переносной USB винчестер, на который я подшаманил в качестве загрузочной ОС Ubuntu Linux. Я её использую как "спасательную" операционку, типа Live CD, и иногда в ней работаю. В общем, подумал я, что было бы не плохо иметь возможность загружать эту ОСь в VirtualBox. Понасоскребав различных инструкций из мануалов и интернетов я составил свой рецепт, как это делать.

И так, запускаем в VirtualBox Ubuntu Linux установленную на USB HDD, как обычную виртуальную машину. Кстати, для флешек этот рецепт так же подходит.

<!--more-->

![Ubuntu Linux в VirtualBox](/imgs/virtualbox-boot-from-usb-hdd/01.jpg)

###Дано:
    * Компьютер с Windows 7 x64
    * Загрузочный USB HDD с Ubuntu 12.04TLS

###Задача:

Запустить Ubuntu, установленную на USB Hard Disk Drive, внутри VirtualBox и пользоваться двумя системами параллельно.

###Решение:

Для начала нужно **запустить коммандную строку** (консоль, cmd.exe) **от имени администратора (!!! ОБЯЗАТЕЛЬНО !!!)**, если вы используете Windows 7 или Vista.

![how to cmd start](/imgs/virtualbox-boot-from-usb-hdd/02.png)

И выполнить в ней следующие три команды.
<kbd class="pre">
C:
cd "%PROGRAMFILES%\..\Program Files\Oracle\VirtualBox\"
VBoxManage internalcommands createrawvmdk -filename "%USERPROFILE%\USB-HDD-connector.vmdk" -rawdisk \\.\PhysicalDrive1
</kbd>

###Теперь рассмотрим эти команды подробнее:

Первая строка вам понадобится в случае если текущий путь в консоли начинается с раздела отличного от того, в который инсталлирован ваш VirtualBox.

Вторая строка определяет директорию в которой будут выполняться следующие команды. В моем случае - это `C:\Program&nbsp;Files\Oracle\VirtualBox\`", так как моя программа виртуализации установлена в папку, которую предлагают для установки её разработчики.

Третья команда создает файл *USB-HDD-connector.vmdk*, который будет связывать наш внешний HDD с операционной системой и VirtualBox. Именно этот файл и нужно будет добавить как первичный диск для загрузки вашей виртуальной машины. НО! Прежде чем выполнять эту команду, нужно уточнить номер, под которым ваш внешний жесткий диск известен системе.

###Как узнать номер диска с которогу вы хотите загружаться?

А очень просто! Для этого нужно открыть панель "управление компьютером" раздел "управление дисками". Панель вызвать можно двумя способами:

    - Кликнуть правой кнопкой мыши на ярлыке "мой компьютер" и выбрать в меню строку "управление";
    - Выполнить команду `%windir%\system32\compmgmt.msc /s`. Для этого нажмите <kbd>Win + R</kbd>, введите эту команду и нажмите <kbd>enter</kbd>.

Лично я предпочитаю второй вариант, правда для этого нужно помнить эту команду. Благо я однажды добавил в панель инструментов своего TotalCommander'а кнопку, которая открывает окно "управление компьютером". Что, то я отвлекся...

В разделе "управление дисками" ищем свой диск. Диск 0, Диск 1, Диск 2... Цифры - это и есть номера дисков.

![pс managment](/imgs/virtualbox-boot-from-usb-hdd/03.png)

В моем случае - это был **Диск 1**. Так вот, в вышеописаной команде есть такая подстрока `\\.\PhysicalDrive1`. Последняя цифра здесь должна совпадать с номером диска, который вы узнали в панели управления компьютером.

Ещё один момент, который я хотел бы описать - это место где будет создан нужный нам файл. В моем варианте - `%USERPROFILE%\USB-HDD-connector.vmdk` - это значит, что в папке `%USERPROFILE%` *(это системная переменная Windows, которая будет заменена интерпретатором командной строки на путь к папке пользователя, под которым вы авторизованы в системе)* будет создан файл `USB-HDD-connector.vmdk`. Конечно же вы можете использовать здель любое удобное вам имя файла и путь, но если в этой строке есть пробелы, то её обязательно нужно заключить в кавычки. Иначе интерпретатор воспримйет этот пробел как переход к следующей инструкции.

###В итоге в вашей консоли должа быть примерно следующая картина:

![cmd](/imgs/virtualbox-boot-from-usb-hdd/04.png)

В случае успешного выполнения команды и создания файла связи вы увидите ответ: <kbd>RAW host disk access VMDK file %userpofile%\USB-HDD-connector.vmdk created successfully</kbd>". Вооот. Осталось дело за малым - создать виртуальную машину и выбрать в качестве жесткого диска файл, который мы только что создали. Ах да... И включить его как "первичный мастер".

![virtual machine](/imgs/virtualbox-boot-from-usb-hdd/05.png)

Сразу хотелось бы предупредить, что VirtualBox может ругаться на то, что такого диска не существует и виртуальная машина не запустится. Это связано с тем, что у пользователя под которым вы авторизованы в системе недостаточно прав. Чтобы обойти эту неприятность запустите ваш VirtualBox от имени администратора.
